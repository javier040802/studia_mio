<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Studia - Principal</title>
  <style>
    body{font-family:system-ui,Arial;margin:0;padding:0}
    header.menu{background:#0b5; padding:16px;color:#fff;display:flex;align-items:center;justify-content:space-between}
    header.menu h1{margin:0}
    nav ul{list-style:none;margin:0;padding:0;display:flex;gap:12px}
    nav a{color:#fff;text-decoration:none}
    main{padding:16px}
    .seccion{margin-bottom:20px}
    #habit-container{display:flex;flex-direction:column;gap:8px}
    .habit{padding:8px;border:1px solid #ddd;border-radius:6px}
    button{cursor:pointer}
    .hidden{display:none}
    .welcome{padding:12px;background:#f5f5f5;border-radius:8px}
    .actions a{margin-right:8px}
  </style>
</head>
<body>
  <header class="menu">
    <h1>Studia</h1>
    <nav>
      <ul id="menu-list">
        <li><a href="/index.html">Inicio</a></li>
        <li><a href="#habitos">Hábitos</a></li>
        <li><a href="#perfil">Perfil</a></li>
        <li id="menu-login"><a href="/login.html">Iniciar sesión</a></li>
        <li id="menu-register"><a href="/register.html">Registrarse</a></li>
        <li id="menu-logout" class="hidden"><a href="#" id="logout">Salir</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section id="home" class="seccion">
      <h2>Bienvenido a Studia</h2>
      <div class="welcome" id="welcome-box">
        <p>Organiza y sigue tus hábitos de forma sencilla.</p>
        <p class="actions">
          <a href="/login.html">Iniciar sesión</a> |
          <a href="/register.html">Crear cuenta</a>
        </p>
      </div>
    </section>

    <!-- Panel embebido directamente en la página principal -->
    <section id="habitos" class="seccion hidden">
      <h2>Lista de Hábitos</h2>
      <div id="habit-container"></div>
      <button id="add-habit">➕ Agregar Hábito</button>
    </section>

    <section id="perfil" class="seccion hidden">
      <h2>Mi Perfil</h2>
      <p>Nombre de usuario: <strong id="username"></strong></p>
      <p>Email: <span id="useremail"></span></p>
    </section>
  </main>

  <script>
    // Mostrar/ocultar secciones según si hay usuario logueado
    const currentEmail = localStorage.getItem('studia_current_user');
    const menuLogin = document.getElementById('menu-login');
    const menuRegister = document.getElementById('menu-register');
    const menuLogout = document.getElementById('menu-logout');
    const welcomeBox = document.getElementById('welcome-box');
    const habitosSection = document.getElementById('habitos');
    const perfilSection = document.getElementById('perfil');

    function showLoggedInView(user) {
      menuLogin.classList.add('hidden');
      menuRegister.classList.add('hidden');
      menuLogout.classList.remove('hidden');
      welcomeBox.classList.add('hidden');
      habitosSection.classList.remove('hidden');
      perfilSection.classList.remove('hidden');

      document.getElementById('username').textContent = user.username || 'Usuario';
      document.getElementById('useremail').textContent = user.email || '';

      // Inicializar hábitos
      initHabits(user);
    }

    function showLoggedOutView() {
      menuLogin.classList.remove('hidden');
      menuRegister.classList.remove('hidden');
      menuLogout.classList.add('hidden');
      welcomeBox.classList.remove('hidden');
      habitosSection.classList.add('hidden');
      perfilSection.classList.add('hidden');
    }

    const users = JSON.parse(localStorage.getItem('studia_users') || '[]');
    const me = users.find(u => u.email === currentEmail);

    if (me) {
      showLoggedInView(me);
    } else {
      showLoggedOutView();
    }

    // Logout
    document.getElementById('logout').addEventListener('click', (e) => {
      e.preventDefault();
      localStorage.removeItem('studia_current_user');
      // Recargar para actualizar la vista
      window.location.href = '/index.html';
    });

    // Habits logic (per-user localStorage)
    const habitContainer = document.getElementById('habit-container');
    let habits = [];

    function initHabits(user) {
      const STORAGE_KEY = `habits_${user.email}`;
      habits = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

      function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(habits)); }

      function renderHabits(){
        habitContainer.innerHTML = '';
        if (habits.length === 0) habitContainer.innerHTML = '<em>No hay hábitos aún.</em>';
        habits.forEach((h, idx) => {
          const div = document.createElement('div');
          div.className = 'habit';
          div.innerHTML = `<strong>${h.title}</strong> — ${h.desc || ''} <button data-idx="${idx}" class="del">Eliminar</button>`;
          habitContainer.appendChild(div);
        });
      }

      document.getElementById('add-habit').addEventListener('click', () => {
        const title = prompt('Nombre del hábito');
        if (!title) return;
        const desc = prompt('Descripción (opcional)');
        habits.push({ title, desc });
        save();
        renderHabits();
      });

      habitContainer.addEventListener('click', (e) => {
        if (e.target.classList.contains('del')){
          const i = Number(e.target.dataset.idx);
          if (!Number.isNaN(i)){
            habits.splice(i,1);
            save();
            renderHabits();
          }
        }
      });

      renderHabits();
    }
  </script>
</body>
</html>
